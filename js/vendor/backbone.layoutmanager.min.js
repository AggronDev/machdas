/*!
 * backbone.layoutmanager.js v0.8.7
 * Copyright 2013, Tim Branyen (@tbranyen)
 * backbone.layoutmanager.js may be freely distributed under the MIT license.
 */
(function(i){var n;var l=i.Backbone;var m=i._;var e=l.$;var h=i.console&&i.console.warn;var f=i.console&&i.console.trace;var c=l.View.prototype._configure;var b=l.View.prototype.render;var g=Array.prototype.push;var j=Array.prototype.concat;var d=Array.prototype.splice;var a=l.View.extend({constructor:function k(o){o=o||{};a.setupView(this,o);l.View.call(this,o)},insertView:function(o,p){if(p){return this.setView(o,p,true)}return this.setView(o,true)},insertViews:function(o){if(m.isArray(o)){return this.setViews({"":o})}m.each(o,function(q,p){o[p]=m.isArray(q)?q:[q]});return this.setViews(o)},getView:function(o){if(o==null){o=arguments[1]}return this.getViews(o).first().value()},getViews:function(p){var o=m.chain(this.views).map(function(q){return m.isArray(q)?q:[q]},this).flatten().value();if(typeof p==="string"){return m.chain([this.views[p]]).flatten()}if(typeof p==="object"){return m.chain([m.where(o,p)]).flatten()}return m.chain(typeof p==="function"?m.filter(o,p):o)},removeView:function(o){return this.getViews(o).each(function(p){p.remove()})},setView:function(r,p,u){var s,t,q;var o=this;if(typeof r!=="string"){u=p;p=r;r=""}this.views=this.views||{};s=p.__manager__;t=this.views[r];if(!s){throw new Error("Please set `View#manage` property with selector '"+r+"' to `true`.")}q=p.getAllOptions();s.parent=o;s.selector=r;p.on("all",function(v){if(v!=="beforeRender"&&v!=="afterRender"){o.trigger.apply(o,arguments)}},p);if(!u){if(s.hasRendered){q.partial(o.$el,p.$el,o.__manager__,s)}if(t){m.each(j.call([],t),function(v){v.remove()})}return this.views[r]=p}this.views[r]=j.call([],t||[],p);s.insert=true;return p},setViews:function(o){m.each(o,function(p,q){if(m.isArray(p)){return m.each(p,function(r){this.insertView(q,r)},this)}this.setView(q,p)},this);return this},render:function(){var o=this;var p=o.getAllOptions();var s=o.__manager__;var t=s.parent;var r=t&&t.__manager__;var v=p.deferred();function u(){var x,y;if(t){if(!p.contains(t.el,o.el)){p.partial(t.$el,o.$el,r,s)}}o.delegateEvents();s.hasRendered=true;if(x=s.queue.shift()){x()}else{delete s.queue}function w(){var z=p.afterRender;if(z){z.call(o,o)}o.trigger("afterRender",o);if(s.noel&&o.$el.length>1){if(h&&!p.suppressWarnings){i.console.warn("Using `el: false` with multiple top level elements is not supported.");if(f){i.console.trace()}}}}if(r&&r.queue){t.once("afterRender",w)}else{w()}return v.resolveWith(o,[o])}function q(){var w=o.getAllOptions();var y=o.__manager__;var z=y.parent;var x=z&&z.__manager__;o._render(a._viewRender,w).done(function(){if(!m.keys(o.views).length){return u()}var A=m.map(o.views,function(B){var C=m.isArray(B);if(C&&B.length){return m.reduce(B.slice(1),function(E,D){return E.then(function(){return D.render()})},B[0].render())}return !C?B.render():B});w.when(A).done(u)})}if(s.queue){g.call(s.queue,q)}else{s.queue=[];q(o,v)}v.view=o;return v},remove:function(){a._removeView(this,true);return this._remove.apply(this,arguments)},getAllOptions:function(){return m.extend({},this,a.prototype.options,this.options)}},{_cache:{},_makeAsync:function(p,o){var q=p.deferred();q.async=function(){q._isAsync=true;return o};return q},_viewRender:function(u,w){var o,q,t,v;var r=u.__manager__;function p(x){if(x){if(r.noel){x=e.trim(x);v=e(x);u.$el.slice(1).remove();u.$el.replaceWith(v);u.setElement(v,false)}else{w.html(u.$el,x)}}t.resolveWith(u,[u])}function s(x,z){var A;var y=a._makeAsync(w,function(B){p(B)});a.cache(o,z);if(z){A=w.render.call(y,z,x)}if(!y._isAsync){p(A)}}return{render:function(){var x=u.serialize||w.serialize;var y=u.template||w.template;if(m.isFunction(x)){x=x.call(u)}t=a._makeAsync(w,function(z){s(x,z)});if(typeof y==="string"){o=w.prefix+y}if(q=a.cache(o)){s(x,q,o);return t}if(typeof y==="string"){q=w.fetch.call(t,w.prefix+y)}else{if(typeof y==="function"){q=y}else{if(y!=null){q=w.fetch.call(t,y)}}}if(!t._isAsync){s(x,q)}return t}}},_removeViews:function(p,q){var o;if(typeof p==="boolean"){q=p;p=this}p=p||this;p.getViews().each(function(r){if(r.__manager__.hasRendered||q){a._removeView(r,q)}})},_removeView:function(p,s){var o;var r=p.__manager__;var q=typeof p.keep==="boolean"?p.keep:p.options.keep;if((!q&&r.insert===true)||s){a.cleanViews(p);p._removeViews(true);p.$el.remove();if(!r.parent){return}o=r.parent.views[r.selector];if(m.isArray(o)){return m.each(m.clone(o),function(t,u){if(t&&t.__manager__===r){d.call(o,u,1)}})}delete r.parent.views[r.selector]}},cache:function(p,o){if(p in this._cache&&o==null){return this._cache[p]}else{if(p!=null&&o!=null){return this._cache[p]=o}}},cleanViews:function(o){m.each(j.call([],o),function(p){p.unbind();if(p.model instanceof l.Model){p.model.off(null,null,p)}if(p.collection instanceof l.Collection){p.collection.off(null,null,p)}p.stopListening();m.result(p.getAllOptions(),"cleanup")})},configure:function(o){m.extend(a.prototype.options,o);if(o.manage){l.View.prototype.manage=true}if(o.el===false){l.View.prototype.el=false}if(o.suppressWarnings===true){l.View.prototype.suppressWarnings=true}},setupView:function(o,p){m.each(j.call([],o),function(r){if(r.__manager__){return}var q,u,s;var t=a.prototype;var v=m.pick(r,n);m.defaults(r,{views:{},__manager__:{},_removeViews:a._removeViews,_removeView:a._removeView},a.prototype);p=r.options=m.defaults(p||{},r.options,t.options);s=m.pick(p,j.call(["events"],m.values(p.events)));m.extend(r,s);if(v.render===a.prototype.render||v.render===l.View.prototype.render){delete v.render}m.extend(p,v);r._remove=l.View.prototype.remove;r._render=function(A,x){var w=this;var z=w.__manager__;var y=x.beforeRender;if(z.hasRendered){this._removeViews()}if(y){y.call(this,this)}this.trigger("beforeRender",this);return A(this,x).render()};r.render=a.prototype.render;if(r.remove!==t.remove){r._remove=r.remove;r.remove=t.remove}q=p.views||r.views;if(m.keys(q).length){u=q;r.views={};r.setViews(u)}if(r.options.template){r.options.template=p.template}else{if(r.template){p.template=r.template}}})}});l.Layout=a;a.VERSION="0.8.7";l.View.prototype._configure=function(p){var o,q;if("el" in p?p.el===false:this.el===false){o=true}q=c.apply(this,arguments);if(p.manage||this.manage){a.setupView(this)}if(this.__manager__){this.__manager__.noel=o;this.__manager__.suppressWarnings=p.suppressWarnings}return q};a.prototype.options={prefix:"",deferred:function(){return e.Deferred()},fetch:function(o){return m.template(e(o).html())},partial:function(s,r,q,p){if(p.selector){if(q.noel){var o=s.filter(p.selector);s=o.length?o:s.find(p.selector)}else{s=s.find(p.selector)}}if(p.insert){this.insert(s,r)}else{this.html(s,r)}},html:function(p,o){p.html(o)},insert:function(p,o){p.append(o)},when:function(o){return e.when.apply(null,o)},render:function(p,o){return p(o)},contains:function(o,p){return e.contains(o,p)}};n=m.keys(a.prototype.options)})(typeof global==="object"?global:this);